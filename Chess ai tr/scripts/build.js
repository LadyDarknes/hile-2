(()=>{var e={437:(e,t,r)=>{var n,o=function(e){var t="b",r="w",n=-1,o="p",i="k",a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",s=["1-0","0-1","1/2-1/2","*"],u={b:[16,32,17,15],w:[-16,-32,-17,-15]},l={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},c=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],f=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],p={p:0,n:1,b:2,r:3,q:4,k:5},d={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},h={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},g={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},v={w:[{square:g.a1,flag:h.QSIDE_CASTLE},{square:g.h1,flag:h.KSIDE_CASTLE}],b:[{square:g.a8,flag:h.QSIDE_CASTLE},{square:g.h8,flag:h.KSIDE_CASTLE}]},m=new Array(128),y={w:n,b:n},b=r,w={w:0,b:0},S=n,E=0,_=1,A=[],C={},k={};function R(e){void 0===e&&(e=!1),m=new Array(128),y={w:n,b:n},b=r,w={w:0,b:0},S=n,E=0,_=1,A=[],e||(C={}),k={},N(M())}function I(){for(var e=[],t={},r=function(e){e in k&&(t[e]=k[e])};A.length>0;)e.push(z());for(r(M());e.length>0;)Y(e.pop()),r(M());k=t}function T(){q(a)}function q(e,o){void 0===o&&(o=!1);var i=e.split(/\s+/),a=i[0],s=0;if(!P(e).valid)return!1;R(o);for(var u=0;u<a.length;u++){var l=a.charAt(u);if("/"===l)s+=8;else if(-1!=="0123456789".indexOf(l))s+=parseInt(l,10);else{var c=l<"a"?r:t;D({type:l.toLowerCase(),color:c},J(s)),s++}}return b=i[1],i[2].indexOf("K")>-1&&(w.w|=h.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(w.w|=h.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(w.b|=h.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(w.b|=h.QSIDE_CASTLE),S="-"===i[3]?n:g[i[3]],E=parseInt(i[4],10),_=parseInt(i[5],10),N(M()),!0}function P(e){var t=e.split(/\s+/);if(6!==t.length)return{valid:!1,error_number:1,error:"FEN string must contain six space-delimited fields."};if(isNaN(t[5])||parseInt(t[5],10)<=0)return{valid:!1,error_number:2,error:"6th field (move number) must be a positive integer."};if(isNaN(t[4])||parseInt(t[4],10)<0)return{valid:!1,error_number:3,error:"5th field (half move counter) must be a non-negative integer."};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{valid:!1,error_number:4,error:"4th field (en-passant square) is invalid."};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(t[2]))return{valid:!1,error_number:5,error:"3rd field (castling availability) is invalid."};if(!/^(w|b)$/.test(t[1]))return{valid:!1,error_number:6,error:"2nd field (side to move) is invalid."};var r=t[0].split("/");if(8!==r.length)return{valid:!1,error_number:7,error:"1st field (piece positions) does not contain 8 '/'-delimited rows."};for(var n=0;n<r.length;n++){for(var o=0,i=!1,a=0;a<r[n].length;a++)if(isNaN(r[n][a])){if(!/^[prnbqkPRNBQK]$/.test(r[n][a]))return{valid:!1,error_number:9,error:"1st field (piece positions) is invalid [invalid piece]."};o+=1,i=!1}else{if(i)return{valid:!1,error_number:8,error:"1st field (piece positions) is invalid [consecutive numbers]."};o+=parseInt(r[n][a],10),i=!0}if(8!==o)return{valid:!1,error_number:10,error:"1st field (piece positions) is invalid [row too large]."}}return"3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1]?{valid:!1,error_number:11,error:"Illegal en-passant square"}:{valid:!0,error_number:0,error:"No errors."}}function M(){for(var e=0,t="",o=g.a8;o<=g.h1;o++){if(null==m[o])e++;else{e>0&&(t+=e,e=0);var i=m[o].color,a=m[o].type;t+=i===r?a.toUpperCase():a.toLowerCase()}o+1&136&&(e>0&&(t+=e),o!==g.h1&&(t+="/"),e=0,o+=8)}var s="";w.w&h.KSIDE_CASTLE&&(s+="K"),w.w&h.QSIDE_CASTLE&&(s+="Q"),w.b&h.KSIDE_CASTLE&&(s+="k"),w.b&h.QSIDE_CASTLE&&(s+="q"),s=s||"-";var u=S===n?"-":J(S);return[t,b,s,u,E,_].join(" ")}function L(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(C[e[t]]=e[t+1]);return C}function N(e){A.length>0||(e!==a?(C.SetUp="1",C.FEN=e):(delete C.SetUp,delete C.FEN))}function x(e){var t=m[g[e]];return t?{type:t.type,color:t.color}:null}function D(e,t){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(t in g))return!1;var r=g[t];return(e.type!=i||y[e.color]==n||y[e.color]==r)&&(m[r]={type:e.type,color:e.color},e.type===i&&(y[e.color]=r),N(M()),!0)}function O(e,t,r,n,i){var a={color:b,from:t,to:r,flags:n,piece:e[t].type};return i&&(a.flags|=h.PROMOTION,a.promotion=i),e[r]?a.captured=e[r].type:n&h.EP_CAPTURE&&(a.captured=o),a}function U(e){function t(e,t,r,n,i){if(e[r].type!==o||0!==Z(n)&&7!==Z(n))t.push(O(e,r,n,i));else for(var a=["q","r","b","n"],s=0,u=a.length;s<u;s++)t.push(O(e,r,n,i,a[s]))}var r=[],n=b,a=ee(n),s={b:1,w:6},c=g.a8,f=g.h1,p=!1,d=void 0===e||!("legal"in e)||e.legal,v=void 0===e||!("piece"in e)||"string"!=typeof e.piece||e.piece.toLowerCase();if(void 0!==e&&"square"in e){if(!(e.square in g))return[];c=f=g[e.square],p=!0}for(var E=c;E<=f;E++)if(136&E)E+=7;else{var _=m[E];if(null!=_&&_.color===n)if(_.type!==o||!0!==v&&v!==o){if(!0===v||v===_.type)for(var A=0,C=l[_.type].length;A<C;A++){var k=l[_.type][A];for(R=E;!(136&(R+=k));){if(null!=m[R]){if(m[R].color===n)break;t(m,r,E,R,h.CAPTURE);break}if(t(m,r,E,R,h.NORMAL),"n"===_.type||"k"===_.type)break}}}else{var R=E+u[n][0];if(null==m[R]){t(m,r,E,R,h.NORMAL);R=E+u[n][1];s[n]===Z(E)&&null==m[R]&&t(m,r,E,R,h.BIG_PAWN)}for(A=2;A<4;A++)136&(R=E+u[n][A])||(null!=m[R]&&m[R].color===a?t(m,r,E,R,h.CAPTURE):R===S&&t(m,r,E,S,h.EP_CAPTURE))}}if(!(!0!==v&&v!==i||p&&f!==y[n])){if(w[n]&h.KSIDE_CASTLE){var I=(T=y[n])+2;null!=m[T+1]||null!=m[I]||$(a,y[n])||$(a,T+1)||$(a,I)||t(m,r,y[n],I,h.KSIDE_CASTLE)}var T;if(w[n]&h.QSIDE_CASTLE)I=(T=y[n])-2,null!=m[T-1]||null!=m[T-2]||null!=m[T-3]||$(a,y[n])||$(a,T-1)||$(a,I)||t(m,r,y[n],I,h.QSIDE_CASTLE)}if(!d)return r;var q=[];for(E=0,C=r.length;E<C;E++)Y(r[E]),j(n)||q.push(r[E]),z();return q}function Q(e,t){var r="";if(e.flags&h.KSIDE_CASTLE)r="O-O";else if(e.flags&h.QSIDE_CASTLE)r="O-O-O";else{if(e.piece!==o){var n=function(e,t){for(var r=e.from,n=e.to,o=e.piece,i=0,a=0,s=0,u=0,l=t.length;u<l;u++){var c=t[u].from,f=t[u].to;o===t[u].piece&&r!==c&&n===f&&(i++,Z(r)===Z(c)&&a++,V(r)===V(c)&&s++)}return i>0?a>0&&s>0?J(r):s>0?J(r).charAt(1):J(r).charAt(0):""}(e,t);r+=e.piece.toUpperCase()+n}e.flags&(h.CAPTURE|h.EP_CAPTURE)&&(e.piece===o&&(r+=J(e.from)[0]),r+="x"),r+=J(e.to),e.flags&h.PROMOTION&&(r+="="+e.promotion.toUpperCase())}return Y(e),B()&&(G()?r+="#":r+="+"),z(),r}function K(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function $(e,n){for(var i=g.a8;i<=g.h1;i++)if(136&i)i+=7;else if(null!=m[i]&&m[i].color===e){var a=m[i],s=i-n,u=s+119;if(c[u]&1<<p[a.type]){if(a.type===o){if(s>0){if(a.color===r)return!0}else if(a.color===t)return!0;continue}if("n"===a.type||"k"===a.type)return!0;for(var l=f[u],d=i+l,h=!1;d!==n;){if(null!=m[d]){h=!0;break}d+=l}if(!h)return!0}}return!1}function j(e){return $(ee(e),y[e])}function B(){return j(b)}function G(){return B()&&0===U().length}function W(){return!B()&&0===U().length}function F(){for(var e={},t=[],r=0,n=0,o=g.a8;o<=g.h1;o++)if(n=(n+1)%2,136&o)o+=7;else{var i=m[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,"b"===i.type&&t.push(n),r++)}if(2===r)return!0;if(3===r&&(1===e.b||1===e.n))return!0;if(r===e.b+2){var a=0,s=t.length;for(o=0;o<s;o++)a+=t[o];if(0===a||a===s)return!0}return!1}function X(){for(var e=[],t={},r=!1;;){var n=z();if(!n)break;e.push(n)}for(;;){var o=M().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(r=!0),!e.length)break;Y(e.pop())}return r}function Y(e){var r=b,a=ee(r);if(function(e){A.push({move:e,kings:{b:y.b,w:y.w},turn:b,castling:{b:w.b,w:w.w},ep_square:S,half_moves:E,move_number:_})}(e),m[e.to]=m[e.from],m[e.from]=null,e.flags&h.EP_CAPTURE&&(b===t?m[e.to-16]=null:m[e.to+16]=null),e.flags&h.PROMOTION&&(m[e.to]={type:e.promotion,color:r}),m[e.to].type===i){if(y[m[e.to].color]=e.to,e.flags&h.KSIDE_CASTLE){var s=e.to-1,u=e.to+1;m[s]=m[u],m[u]=null}else e.flags&h.QSIDE_CASTLE&&(s=e.to+1,u=e.to-2,m[s]=m[u],m[u]=null);w[r]=""}if(w[r])for(var l=0,c=v[r].length;l<c;l++)if(e.from===v[r][l].square&&w[r]&v[r][l].flag){w[r]^=v[r][l].flag;break}if(w[a])for(l=0,c=v[a].length;l<c;l++)if(e.to===v[a][l].square&&w[a]&v[a][l].flag){w[a]^=v[a][l].flag;break}S=e.flags&h.BIG_PAWN?"b"===b?e.to-16:e.to+16:n,e.piece===o||e.flags&(h.CAPTURE|h.EP_CAPTURE)?E=0:E++,b===t&&_++,b=ee(b)}function z(){var e=A.pop();if(null==e)return null;var r=e.move;y=e.kings,b=e.turn,w=e.castling,S=e.ep_square,E=e.half_moves,_=e.move_number;var n,i,a=b,s=ee(b);if(m[r.from]=m[r.to],m[r.from].type=r.piece,m[r.to]=null,r.flags&h.CAPTURE)m[r.to]={type:r.captured,color:s};else if(r.flags&h.EP_CAPTURE){var u;u=a===t?r.to-16:r.to+16,m[u]={type:o,color:s}}return r.flags&(h.KSIDE_CASTLE|h.QSIDE_CASTLE)&&(r.flags&h.KSIDE_CASTLE?(n=r.to+1,i=r.to-1):r.flags&h.QSIDE_CASTLE&&(n=r.to-2,i=r.to+1),m[n]=m[i],m[i]=null),r}function H(e,t){var r=K(e);if(t){var n=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(n)var a=n[1],s=n[2],u=n[3],l=n[4]}var c=function(e){var t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return o}return"o"===(t=t.toLowerCase())?i:t}(r),f=null,p=U({legal:!0,piece:a||c});if(f=p,t){var d=U({legal:!1,piece:a||c});f=d}for(var h=0,v=f.length;h<v;h++){if(r===K(Q(f[h],p))||t&&r===K(Q(f[h],d)))return f[h];if(n&&(!a||a.toLowerCase()==f[h].piece)&&g[s]==f[h].from&&g[u]==f[h].to&&(!l||l.toLowerCase()==f[h].promotion))return f[h]}return null}function Z(e){return e>>4}function V(e){return 15&e}function J(e){var t=V(e),r=Z(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function ee(e){return e===r?t:r}function te(e){var t=re(e);t.san=Q(t,U({legal:!0})),t.to=J(t.to),t.from=J(t.from);var r="";for(var n in h)h[n]&t.flags&&(r+=d[n]);return t.flags=r,t}function re(e){var t=e instanceof Array?[]:{};for(var r in e)t[r]="object"==typeof r?re(e[r]):e[r];return t}function ne(e){return e.replace(/^\s+|\s+$/g,"")}function oe(e){for(var t=U({legal:!1}),r=0,n=b,o=0,i=t.length;o<i;o++)Y(t[o]),j(n)||(e-1>0?r+=oe(e-1):r++),z();return r}return q(void 0===e?a:e),{WHITE:r,BLACK:t,PAWN:o,KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:i,SQUARES:function(){for(var e=[],t=g.a8;t<=g.h1;t++)136&t?t+=7:e.push(J(t));return e}(),FLAGS:d,load:function(e){return q(e)},reset:function(){return T()},moves:function(e){for(var t=U(e),r=[],n=0,o=t.length;n<o;n++)void 0!==e&&"verbose"in e&&e.verbose?r.push(te(t[n])):r.push(Q(t[n],U({legal:!0})));return r},in_check:function(){return B()},in_checkmate:function(){return G()},in_stalemate:function(){return W()},in_draw:function(){return E>=100||W()||F()||X()},insufficient_material:function(){return F()},in_threefold_repetition:function(){return X()},game_over:function(){return E>=100||G()||W()||F()||X()},validate_fen:function(e){return P(e)},fen:function(){return M()},board:function(){for(var e=[],t=[],r=g.a8;r<=g.h1;r++)null==m[r]?t.push(null):t.push({type:m[r].type,color:m[r].color}),r+1&136&&(e.push(t),t=[],r+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",r="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,n=[],o=!1;for(var i in C)n.push("["+i+' "'+C[i]+'"]'+t),o=!0;o&&A.length&&n.push(t);for(var a=function(e){var t=k[M()];return void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`),e},s=[];A.length>0;)s.push(z());var u=[],l="";for(0===s.length&&u.push(a(""));s.length>0;){l=a(l);var c=s.pop();A.length||"b"!==c.color?"w"===c.color&&(l.length&&u.push(l),l=_+"."):l=_+". ...",l=l+" "+Q(c,U({legal:!1})),Y(c)}if(l.length&&u.push(a(l)),void 0!==C.Result&&u.push(C.Result),0===r)return n.join("")+u.join(" ");var f=function(){return n.length>0&&" "===n[n.length-1]&&(n.pop(),!0)},p=function(e,o){for(var i of o.split(" "))if(i){if(e+i.length>r){for(;f();)e--;n.push(t),e=0}n.push(i),e+=i.length,n.push(" "),e++}return f()&&e--,e},d=0;for(i=0;i<u.length;i++)d+u[i].length>r&&u[i].includes("{")?d=p(d,u[i]):(d+u[i].length>r&&0!==i?(" "===n[n.length-1]&&n.pop(),n.push(t),d=0):0!==i&&(n.push(" "),d++),n.push(u[i]),d+=u[i].length);return n.join("")},load_pgn:function(e,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy;function n(e){return e.replace(/\\/g,"\\")}var o="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",i=new RegExp("^(\\[((?:"+n(o)+")|.)*\\])(?:"+n(o)+"){2}"),a=i.test(e)?i.exec(e)[1]:"";T();var u=function(e,t){for(var r="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},i=e.split(new RegExp(n(r))),a="",s="",u=0;u<i.length;u++)a=i[u].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=i[u].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),ne(a).length>0&&(o[a]=s);return o}(a,t);for(var l in u)L([l,u[l]]);if(!("1"!==u.SetUp||"FEN"in u&&q(u.FEN,!0)))return!1;for(var c=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(n(o),"g")," ")).slice(1,e.length-1))}}`},f=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+e.match(/.{1,2}/g).join("%"))}(e.slice(1,e.length-1))},p=e.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${n(o)}]*)`,"g"),(function(e,t,r){return void 0!==t?c(t):" "+c(`{${r.slice(1)}}`)})).replace(new RegExp(n(o),"g")," "),d=/(\([^\(\)]+\))+?/g;d.test(p);)p=p.replace(d,"");var h=ne(p=(p=(p=p.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));h=h.join(",").replace(/,,+/g,",").split(",");for(var g="",v=0;v<h.length-1;v++){var m=f(h[v]);if(void 0===m){if(null==(g=H(h[v],r)))return!1;Y(g)}else k[M()]=m}if(void 0!==(m=f(h[h.length-1]))&&(k[M()]=m,h.pop()),g=h[h.length-1],s.indexOf(g)>-1)(function(e){for(var t in e)return!0;return!1})(C)&&void 0===C.Result&&L(["Result",g]);else{if(null==(g=H(g,r)))return!1;Y(g)}return!0},header:function(){return L(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=g.a8;t<=g.h1;t++){if(0===V(t)&&(e+=" "+"87654321"[Z(t)]+" |"),null==m[t])e+=" . ";else{var n=m[t].type;e+=" "+(m[t].color===r?n.toUpperCase():n.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return(e+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h\n"}()},turn:function(){return b},move:function(e,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy,n=null;if("string"==typeof e)n=H(e,r);else if("object"==typeof e)for(var o=U(),i=0,a=o.length;i<a;i++)if(e.from===J(o[i].from)&&e.to===J(o[i].to)&&(!("promotion"in o[i])||e.promotion===o[i].promotion)){n=o[i];break}if(!n)return null;var s=te(n);return Y(n),s},undo:function(){var e=z();return e?te(e):null},clear:function(){return R()},put:function(e,t){return D(e,t)},get:function(e){return x(e)},remove:function(e){return function(e){var t=x(e);return m[g[e]]=null,t&&t.type===i&&(y[t.color]=n),N(M()),t}(e)},perft:function(e){return oe(e)},square_color:function(e){if(e in g){var t=g[e];return(Z(t)+V(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],r=[],n=(void 0!==e&&"verbose"in e&&e.verbose);A.length>0;)t.push(z());for(;t.length>0;){var o=t.pop();n?r.push(te(o)):r.push(Q(o,U({legal:!0}))),Y(o)}return r},get_comment:function(){return k[M()]},set_comment:function(e){k[M()]=e.replace("{","[").replace("}","]")},delete_comment:function(){var e=k[M()];return delete k[M()],e},get_comments:function(){return I(),Object.keys(k).map((function(e){return{fen:e,comment:k[e]}}))},delete_comments:function(){return I(),Object.keys(k).map((function(e){var t=k[e];return delete k[e],{fen:e,comment:t}}))}}};t.Chess=o,void 0===(n=function(){return o}.call(t,r,t,e))||(e.exports=n)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{constructor(e,t){this.row=e,this.column=t}toChessSquareString(){return String.fromCharCode("a".charCodeAt(0)+this.column)+(8-this.row)}getRow(){return this.row}getColumn(){return this.column}static fromRowAndColumn(t,r){return new e(t,r)}static fromSquare(t){const r=t.charCodeAt(0)-"a".charCodeAt(0),n=8-parseInt(t[1]);return new e(n,r)}}const t=e=>60*parseInt(e.split(":")[0])+parseInt(e.split(":")[1]),n=e=>{if(e>36)throw new Error("Does not support generating random string of length > 36");return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,e)},o=()=>{return e=void 0,t=void 0,n=function*(){return new Promise((e=>{chrome.storage.local.get(["extensionActive","depthValue","maxWaitTime","newgame","automove","safe","autoPlayNewGame","bongcloud"],(t=>{e(t)}))}))},new((r=void 0)||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}));var e,t,r,n},i=(e,t,r)=>{chrome.runtime.sendMessage({eventPlease:"trusted",x:e,y:t,mouse:r},(function(e){}))},a=(e,t,r,n,o,i)=>{const a=i/8,s=a/2;let u,l,c,f;return"white"===r?(u=n+a*(e.getColumn()+1)-s,l=o+i-a*(8-e.getRow())+s,c=n+a*(t.getColumn()+1)-s,f=o+i-a*(8-t.getRow())+s):(u=n+a*(8-e.getColumn())-s,l=o+i-a*(e.getRow()+1)+s,c=n+a*(8-t.getColumn())-s,f=o+i-a*(t.getRow()+1)+s),{startX:u,startY:l,endX:c,endY:f}};class s{constructor(){this.RED_SQUARE_CLASS_NAME=n(20),this.getPlayerColour=()=>document.querySelector(".clock-bottom").classList.contains("clock-white")?"white":"black"}isMyTurn(){return!!document.querySelector(".clock-bottom")&&document.querySelector(".clock-bottom").classList.contains("clock-player-turn")}amIWhite(){return!!document.querySelector(".clock-bottom")&&document.querySelector(".clock-bottom").classList.contains("clock-white")}getMyTimeInSeconds(){const e=document.querySelector(".clock-bottom");if(e){const r=e.querySelector("span").innerText;return t(r)}return-1}getOpponentTimeInSeconds(){const e=document.querySelector(".clock-top");if(e){const r=e.querySelector("span").innerText;return t(r)}return-1}makeMove(e,t){const r=this.getPlayerColour(),n=document.querySelector(".board"),{left:o,top:s,width:u}=n.getBoundingClientRect(),{startX:l,startY:c,endX:f,endY:p}=a(e,t,r,o,s,u);i(l,c,"D"),i(l,c,"U"),i(f,p,"D"),i(f,p,"U")}draw(e){const t=this.getPlayerColour(),r=document.querySelector(".board"),n=document.createElement("div");n.style.display="block",n.style.position="absolute","white"===t?(n.style.top=12.5*e.getRow()+"%",n.style.left=12.5*e.getColumn()+"%"):(n.style.top=12.5*(7-e.getRow())+"%",n.style.left=12.5*(7-e.getColumn())+"%"),n.style.background="rgba(255, 0, 0, 0.4)",n.style.height="12.5%",n.style.width="12.5%",n.className=this.RED_SQUARE_CLASS_NAME,r.appendChild(n)}clearAllDrawings(){document.querySelectorAll(`.${this.RED_SQUARE_CLASS_NAME}`).forEach((e=>e.remove()))}onNewMove(e){let t=document.querySelector(".clock-bottom").className.includes("clock-player-turn");setInterval((()=>{const r=document.querySelector(".clock-bottom").className.includes("clock-player-turn");t!==r&&(t=r,e())}),50)}getAllMoves(){const e=document.querySelectorAll(".move");let t=[];return e.forEach((e=>{const r=e.querySelector(".white");r&&r.textContent&&t.push(r.textContent);const n=e.querySelector(".black");n&&n.textContent&&t.push(n.textContent)})),t}tryToStartNewGame(){[...document.querySelector(".live-game-buttons-game-over").children][1].click()}}const u=e=>{chrome.runtime.sendMessage(e)};var l=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))};class c{constructor(){var e;this.backgroundMessage="",this.currentDepth="",this.currentRound=0,e=e=>{if("stockfish"===e.type&&(e.message.includes("pv")||e.message.includes("bestmove")))return this.backgroundMessage=e.message,this.currentRound=e.round,e},chrome.runtime.onMessage.addListener(((t,r,n)=>{e(t)}))}startNewGame(){chrome.runtime.sendMessage({type:"stockfish",message:"uci"})}getBestMove(e,t){return l(this,void 0,void 0,(function*(){return this.currentRound++,u({type:"stockfish",message:"stop"}),u({type:"stockfish",message:`go depth ${t}`,position:`position fen ${e}`}),new Promise(((e,t)=>{const r=this.currentRound,n=setInterval((()=>{if(this.currentRound>r&&(clearInterval(n),e("")),"bestmove"===this.backgroundMessage.substring(0,8)){const t=this.backgroundMessage.split(" "),r=t.indexOf("bestmove")+1,o=t[r];clearInterval(n),e(o)}}),100)}))}))}keepFindingBestMove(e,t,r){return l(this,void 0,void 0,(function*(){this.currentRound++,u({type:"stockfish",message:"stop"}),u({type:"stockfish",message:`go depth ${t}`,position:`position fen ${e}`});const n=setInterval((()=>{const e=this.currentRound;this.currentRound>e&&(clearInterval(n),r(""));let t=this.backgroundMessage.split(" ");const o=t.indexOf("depth")+1;let i=0,a="";this.backgroundMessage.includes("pv")&&this.currentDepth!==t[o]?(i=t.indexOf("pv")+1,this.currentDepth=t[o],a=t[i]):"bestmove"===this.backgroundMessage.substring(0,8)&&(i=t.indexOf("bestmove")+1,this.currentDepth="",a=t[i],clearInterval(n)),""!==a&&r(a)}),100)}))}stopAnalyzing(){return u({type:"stockfish",message:"stop"}),new Promise(((e,t)=>{const r=setInterval((()=>{if(""===this.backgroundMessage)clearInterval(r),e("TODO");else if("bestmove"===this.backgroundMessage.substring(0,8)){const t=this.backgroundMessage;this.backgroundMessage="",clearInterval(r),e(t)}}),100)}))}getEvaluation(e,t){return u({type:"stockfish",message:`go depth ${t}`,position:e,depth:t}),new Promise(((e,t)=>{const r=setInterval((()=>{if("info"===this.backgroundMessage.substring(0,4)){const t=this.backgroundMessage.split(" "),n=t.indexOf("score")+2,o=t[n];e(o),clearInterval(r)}}),100)}))}}var f=r(437),p=r.n(f);class d{constructor(){this.RED_SQUARE_CLASS_NAME=n(20),this.getPlayerColour=()=>document.querySelector(".cg-wrap").classList.contains("orientation-black")?"black":"white"}isMyTurn(){const e=document.querySelector(".rclock-bottom"),t=e.textContent,r=t.substring(t.length-2,t.length),n=document.querySelector("#main-wrap > main > div.round__app.variant-standard > div.expiration.expiration-bottom.bar-glider"),o=!!(n&&n.textContent&&n.textContent.includes("first move"));return e.classList.contains("running")||o||"00"===r}amIWhite(){return!1}getMyTimeInSeconds(){return 1e5}getOpponentTimeInSeconds(){return 1e5}makeMove(e,t){const r=this.getPlayerColour(),n=document.querySelector("cg-board"),{left:o,top:s,width:u}=n.getBoundingClientRect(),{startX:l,startY:c,endX:f,endY:p}=a(e,t,r,o,s,u);i(l,c,"D"),i(l,c,"U"),i(f,p,"D"),i(f,p,"U")}draw(e){const t=this.getPlayerColour(),r=document.querySelector("cg-board"),n=document.createElement("div");n.style.display="block",n.style.position="absolute","white"===t?(n.style.top=12.5*e.getRow()+"%",n.style.left=12.5*e.getColumn()+"%"):(n.style.top=12.5*(7-e.getRow())+"%",n.style.left=12.5*(7-e.getColumn())+"%"),n.style.background="rgba(255, 0, 0, 0.4)",n.style.height="12.5%",n.style.width="12.5%",n.className=this.RED_SQUARE_CLASS_NAME,r.appendChild(n)}clearAllDrawings(){document.querySelectorAll(`.${this.RED_SQUARE_CLASS_NAME}`).forEach((e=>e.remove()))}onNewMove(e){let t=document.querySelectorAll("u8t").length;window.setInterval((()=>{const r=document.querySelectorAll("u8t").length;r!==t&&(t=r,e())}),50)}getAllMoves(){const e=document.querySelectorAll("u8t"),t=[];return e.forEach((e=>{t.push(e.textContent||"")})),t}tryToStartNewGame(){const e=document.querySelector("#main-wrap > main > div.round__app.variant-standard > div.rcontrols > div > a:nth-child(2)");e&&"New opponent"===e.textContent&&e.click()}}var h=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))};chrome.runtime.onMessage.addListener((function(e){"start"===e.type?u({type:"start"}):"pause"===e.type&&u({type:"pause"})}));const g=(t,r)=>h(void 0,void 0,void 0,(function*(){setTimeout((()=>h(void 0,void 0,void 0,(function*(){let{extensionActive:n,depthValue:i,maxWaitTime:a,automove:s,safe:u,bongcloud:l}=yield o();if(i||(i=10),!n)return;const c=t.getAllMoves(),f=new(p());c.forEach((e=>{f.move(e)}));let d=Math.random()*a;u&&Math.floor(2*Math.random()+1)%2==0&&(i=Math.floor(3*Math.random())+1,d=Math.round(9*Math.random())%3==0?2500:1500),console.log("bongcloud",l);let h="";l&&(h=((e,t)=>{if(console.log("numberOfMovesMade",e),t.amIWhite()){if(0===e)return"f2f3";if(2===e)return"e1f2"}else{if(1===e)return"f7f6";if(3===e)return"e8f7"}return""})(c.length,t)),""===h&&(h=yield r.getBestMove(f.fen(),i)),t.clearAllDrawings();const g=e.fromSquare(h.substring(0,2)),v=e.fromSquare(h.substring(2,4));t.draw(g),t.draw(v),t.isMyTurn()&&s&&setTimeout((()=>{t.makeMove(g,v)}),d)}))),100)}));setTimeout((()=>{const e=new Date("9/20/2021"),t=new Date;e.getTime()-t.getTime()>=0&&h(void 0,void 0,void 0,(function*(){let e,t=new c;const r=window.location.href;if(r.includes("chess.com"))e=new s;else{if(!r.includes("lichess.org"))throw new Error("Unsupported website");e=new d}e.onNewMove((()=>g(e,t))),setTimeout((()=>{g(e,t)}),1200),setInterval((()=>h(void 0,void 0,void 0,(function*(){const{autoPlayNewGame:t}=yield o();t&&e.tryToStartNewGame()}))),500),chrome.runtime.onMessage.addListener((function(r){"start"===r.type&&g(e,t)}))}))}),2e3)})()})();